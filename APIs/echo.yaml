apiVersion: tyk.tyk.io/v1alpha1
kind: ApiDefinition
metadata:
  name: echo
spec:
  name: echo
  protocol: http
  contextRef:
    name: local-operator-context
    namespace: hsandbox-1
  proxy:
    listen_path: /echo/
    target_url: http://httpbin.org/anything/echo
    strip_listen_path: true
  active: true
  use_keyless: true
  enable_context_vars: true
  version_data:
    default_version: Default
    not_versioned: false
    versions:
      Default:
        name: Default
        use_extended_paths: true
        extended_paths:
          virtual:
            - function_source_type: blob
              response_function_name: head
              function_source_uri: "ZnVuY3Rpb24gaGVhZChyZXF1ZXN0LCBzZXNzaW9uLCBjb25maWcpIHsNCiAgICBtZXRob2QgPSAiSEVBRCI7DQogICAgLy9Vc2FnZSBleGFtcGxlczoNCiAgICAvL2xvZygiUmVxdWVzdCBTZXNzaW9uOiAiICsgSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbikpDQogICAgLy9sb2coIkFQSSBDb25maWc6IiArIEpTT04uc3RyaW5naWZ5KGNvbmZpZykpDQoNCiAgICBsb2coIlJlcXVlc3Qgb2JqZWN0ICIgKyBtZXRob2QgKyAiOiIgKyBKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7DQogICAgLy9sb2coIlJlcXVlc3QgQm9keTogIiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuQm9keSkpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IEhlYWRlcnM6IiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuSGVhZGVycykpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IGhlYWRlciB0eXBlOiIgKyB0eXBlb2YgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQoNCiAgICAvKg0KICAgICAgICB2YXIgaGVhZGVycyA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gcmVxdWVzdC5IZWFkZXJzKSB7DQogICAgICAgICAgICBpZiAocmVxdWVzdC5IZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzW2tleV0gPSByZXF1ZXN0LkhlYWRlcnNba2V5XVswXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICovDQoNCiAgICB2YXIgcmVxdWVzdEluZm8gPSB7DQogICAgICAgIEJvZHk6IHJlcXVlc3QuQm9keSwNCiAgICAgICAgSGVhZGVyczogcmVxdWVzdC5IZWFkZXJzLA0KICAgICAgICBTY2hlbWU6IHJlcXVlc3QuU2NoZW1lLA0KICAgICAgICBQYXJhbXM6IHJlcXVlc3QuUGFyYW1zLA0KICAgICAgICBNZXRob2Q6IG1ldGhvZCwNCiAgICAgICAgVVJMOiByZXF1ZXN0LlVSTA0KICAgIH07DQoNCiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSB7DQogICAgICAgIEJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RJbmZvLCB1bmRlZmluZWQsIDQpLA0KICAgICAgICBDb2RlOiAyMDANCiAgICB9Ow0KDQogICAgcmV0dXJuIFR5a0pzUmVzcG9uc2UocmVzcG9uc2VPYmplY3QsIHNlc3Npb24ubWV0YV9kYXRhKTsNCn0="
              path: /
              method: HEAD
              use_session: false
              proxy_on_error: false
            - function_source_type: blob
              response_function_name: options
              function_source_uri: "ZnVuY3Rpb24gb3B0aW9ucyhyZXF1ZXN0LCBzZXNzaW9uLCBjb25maWcpIHsNCiAgICBtZXRob2QgPSAiT1BUSU9OUyI7DQogICAgLy9Vc2FnZSBleGFtcGxlczoNCiAgICAvL2xvZygiUmVxdWVzdCBTZXNzaW9uOiAiICsgSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbikpDQogICAgLy9sb2coIkFQSSBDb25maWc6IiArIEpTT04uc3RyaW5naWZ5KGNvbmZpZykpDQoNCiAgICBsb2coIlJlcXVlc3Qgb2JqZWN0ICIgKyBtZXRob2QgKyAiOiIgKyBKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7DQogICAgLy9sb2coIlJlcXVlc3QgQm9keTogIiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuQm9keSkpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IEhlYWRlcnM6IiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuSGVhZGVycykpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IGhlYWRlciB0eXBlOiIgKyB0eXBlb2YgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQoNCiAgICAvKg0KICAgICAgICB2YXIgaGVhZGVycyA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gcmVxdWVzdC5IZWFkZXJzKSB7DQogICAgICAgICAgICBpZiAocmVxdWVzdC5IZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzW2tleV0gPSByZXF1ZXN0LkhlYWRlcnNba2V5XVswXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICovDQoNCiAgICB2YXIgcmVxdWVzdEluZm8gPSB7DQogICAgICAgIEJvZHk6IHJlcXVlc3QuQm9keSwNCiAgICAgICAgSGVhZGVyczogcmVxdWVzdC5IZWFkZXJzLA0KICAgICAgICBTY2hlbWU6IHJlcXVlc3QuU2NoZW1lLA0KICAgICAgICBQYXJhbXM6IHJlcXVlc3QuUGFyYW1zLA0KICAgICAgICBNZXRob2Q6IG1ldGhvZCwNCiAgICAgICAgVVJMOiByZXF1ZXN0LlVSTA0KICAgIH07DQoNCiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSB7DQogICAgICAgIEJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RJbmZvLCB1bmRlZmluZWQsIDQpLA0KICAgICAgICBDb2RlOiAyMDANCiAgICB9Ow0KDQogICAgcmV0dXJuIFR5a0pzUmVzcG9uc2UocmVzcG9uc2VPYmplY3QsIHNlc3Npb24ubWV0YV9kYXRhKTsNCn0="
              path: /
              method: OPTIONS
              use_session: false
              proxy_on_error: false
            - function_source_type: blob
              response_function_name: del
              function_source_uri: "ZnVuY3Rpb24gZGVsKHJlcXVlc3QsIHNlc3Npb24sIGNvbmZpZykgew0KICAgIG1ldGhvZCA9ICJERUxFVEUiOw0KICAgIC8vVXNhZ2UgZXhhbXBsZXM6DQogICAgLy9sb2coIlJlcXVlc3QgU2Vzc2lvbjogIiArIEpTT04uc3RyaW5naWZ5KHNlc3Npb24pKQ0KICAgIC8vbG9nKCJBUEkgQ29uZmlnOiIgKyBKU09OLnN0cmluZ2lmeShjb25maWcpKQ0KDQogICAgbG9nKCJSZXF1ZXN0IG9iamVjdCAiICsgbWV0aG9kICsgIjoiICsgSlNPTi5zdHJpbmdpZnkocmVxdWVzdCkpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IEJvZHk6ICIgKyBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LkJvZHkpKTsNCiAgICAvL2xvZygiUmVxdWVzdCBIZWFkZXJzOiIgKyBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LkhlYWRlcnMpKTsNCiAgICAvL2xvZygiUmVxdWVzdCBoZWFkZXIgdHlwZToiICsgdHlwZW9mIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuSGVhZGVycykpOw0KDQogICAgLyoNCiAgICAgICAgdmFyIGhlYWRlcnMgPSB7fTsNCiAgICAgICAgZm9yICh2YXIga2V5IGluIHJlcXVlc3QuSGVhZGVycykgew0KICAgICAgICAgICAgaWYgKHJlcXVlc3QuSGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgaGVhZGVyc1trZXldID0gcmVxdWVzdC5IZWFkZXJzW2tleV1bMF07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAqLw0KDQogICAgdmFyIHJlcXVlc3RJbmZvID0gew0KICAgICAgICBCb2R5OiByZXF1ZXN0LkJvZHksDQogICAgICAgIEhlYWRlcnM6IHJlcXVlc3QuSGVhZGVycywNCiAgICAgICAgU2NoZW1lOiByZXF1ZXN0LlNjaGVtZSwNCiAgICAgICAgUGFyYW1zOiByZXF1ZXN0LlBhcmFtcywNCiAgICAgICAgTWV0aG9kOiBtZXRob2QsDQogICAgICAgIFVSTDogcmVxdWVzdC5VUkwNCiAgICB9Ow0KDQogICAgdmFyIHJlc3BvbnNlT2JqZWN0ID0gew0KICAgICAgICBCb2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0SW5mbywgdW5kZWZpbmVkLCA0KSwNCiAgICAgICAgQ29kZTogMjAwDQogICAgfTsNCg0KICAgIHJldHVybiBUeWtKc1Jlc3BvbnNlKHJlc3BvbnNlT2JqZWN0LCBzZXNzaW9uLm1ldGFfZGF0YSk7DQp9"
              path: /
              method: DELETE
              use_session: false
              proxy_on_error: false
            - function_source_type: blob
              response_function_name: patch
              function_source_uri: "ZnVuY3Rpb24gcGF0Y2gocmVxdWVzdCwgc2Vzc2lvbiwgY29uZmlnKSB7DQogICAgbWV0aG9kID0gIlBBVENIIjsNCiAgICAvL1VzYWdlIGV4YW1wbGVzOg0KICAgIC8vbG9nKCJSZXF1ZXN0IFNlc3Npb246ICIgKyBKU09OLnN0cmluZ2lmeShzZXNzaW9uKSkNCiAgICAvL2xvZygiQVBJIENvbmZpZzoiICsgSlNPTi5zdHJpbmdpZnkoY29uZmlnKSkNCg0KICAgIGxvZygiUmVxdWVzdCBvYmplY3QgIiArIG1ldGhvZCArICI6IiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTsNCiAgICAvL2xvZygiUmVxdWVzdCBCb2R5OiAiICsgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5Cb2R5KSk7DQogICAgLy9sb2coIlJlcXVlc3QgSGVhZGVyczoiICsgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQogICAgLy9sb2coIlJlcXVlc3QgaGVhZGVyIHR5cGU6IiArIHR5cGVvZiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LkhlYWRlcnMpKTsNCg0KICAgIC8qDQogICAgICAgIHZhciBoZWFkZXJzID0ge307DQogICAgICAgIGZvciAodmFyIGtleSBpbiByZXF1ZXN0LkhlYWRlcnMpIHsNCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LkhlYWRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICAgIGhlYWRlcnNba2V5XSA9IHJlcXVlc3QuSGVhZGVyc1trZXldWzBdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgKi8NCg0KICAgIHZhciByZXF1ZXN0SW5mbyA9IHsNCiAgICAgICAgQm9keTogcmVxdWVzdC5Cb2R5LA0KICAgICAgICBIZWFkZXJzOiByZXF1ZXN0LkhlYWRlcnMsDQogICAgICAgIFNjaGVtZTogcmVxdWVzdC5TY2hlbWUsDQogICAgICAgIFBhcmFtczogcmVxdWVzdC5QYXJhbXMsDQogICAgICAgIE1ldGhvZDogbWV0aG9kLA0KICAgICAgICBVUkw6IHJlcXVlc3QuVVJMDQogICAgfTsNCg0KICAgIHZhciByZXNwb25zZU9iamVjdCA9IHsNCiAgICAgICAgQm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEluZm8sIHVuZGVmaW5lZCwgNCksDQogICAgICAgIENvZGU6IDIwMA0KICAgIH07DQoNCiAgICByZXR1cm4gVHlrSnNSZXNwb25zZShyZXNwb25zZU9iamVjdCwgc2Vzc2lvbi5tZXRhX2RhdGEpOw0KfQ=="
              path: /
              method: PATCH
              use_session: false
              proxy_on_error: false
            - function_source_type: blob
              response_function_name: post
              function_source_uri: "ZnVuY3Rpb24gcG9zdChyZXF1ZXN0LCBzZXNzaW9uLCBjb25maWcpIHsNCiAgICBtZXRob2QgPSAiUE9TVCI7DQogICAgLy9Vc2FnZSBleGFtcGxlczoNCiAgICAvL2xvZygiUmVxdWVzdCBTZXNzaW9uOiAiICsgSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbikpDQogICAgLy9sb2coIkFQSSBDb25maWc6IiArIEpTT04uc3RyaW5naWZ5KGNvbmZpZykpDQoNCiAgICBsb2coIlJlcXVlc3Qgb2JqZWN0ICIgKyBtZXRob2QgKyAiOiIgKyBKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7DQogICAgLy9sb2coIlJlcXVlc3QgQm9keTogIiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuQm9keSkpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IEhlYWRlcnM6IiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuSGVhZGVycykpOw0KICAgIC8vbG9nKCJSZXF1ZXN0IGhlYWRlciB0eXBlOiIgKyB0eXBlb2YgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQoNCiAgICAvKg0KICAgICAgICB2YXIgaGVhZGVycyA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gcmVxdWVzdC5IZWFkZXJzKSB7DQogICAgICAgICAgICBpZiAocmVxdWVzdC5IZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzW2tleV0gPSByZXF1ZXN0LkhlYWRlcnNba2V5XVswXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICovDQoNCiAgICB2YXIgcmVxdWVzdEluZm8gPSB7DQogICAgICAgIEJvZHk6IHJlcXVlc3QuQm9keSwNCiAgICAgICAgSGVhZGVyczogcmVxdWVzdC5IZWFkZXJzLA0KICAgICAgICBTY2hlbWU6IHJlcXVlc3QuU2NoZW1lLA0KICAgICAgICBQYXJhbXM6IHJlcXVlc3QuUGFyYW1zLA0KICAgICAgICBNZXRob2Q6IG1ldGhvZCwNCiAgICAgICAgVVJMOiByZXF1ZXN0LlVSTA0KICAgIH07DQoNCiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSB7DQogICAgICAgIEJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RJbmZvLCB1bmRlZmluZWQsIDQpLA0KICAgICAgICBDb2RlOiAyMDANCiAgICB9Ow0KDQogICAgcmV0dXJuIFR5a0pzUmVzcG9uc2UocmVzcG9uc2VPYmplY3QsIHNlc3Npb24ubWV0YV9kYXRhKTsNCn0="
              path: /
              method: POST
              use_session: false
              proxy_on_error: false
            - function_source_type: blob
              response_function_name: get
              function_source_uri: "ZnVuY3Rpb24gZ2V0KHJlcXVlc3QsIHNlc3Npb24sIGNvbmZpZykgew0KICAgIG1ldGhvZCA9ICJHRVQiOw0KICAgIC8vVXNhZ2UgZXhhbXBsZXM6DQogICAgbG9nKCJSZXF1ZXN0IFNlc3Npb246ICIgKyBKU09OLnN0cmluZ2lmeShzZXNzaW9uKSkNCiAgICAvL2xvZygiQVBJIENvbmZpZzoiICsgSlNPTi5zdHJpbmdpZnkoY29uZmlnKSkNCg0KICAgIGxvZygiUmVxdWVzdCBvYmplY3QgIiArIG1ldGhvZCArICI6IiArIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTsNCiAgICAvL2xvZygiUmVxdWVzdCBCb2R5OiAiICsgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5Cb2R5KSk7DQogICAgLy9sb2coIlJlcXVlc3QgSGVhZGVyczoiICsgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQogICAgbG9nKCJSZXF1ZXN0IGhlYWRlciB0eXBlOiIgKyB0eXBlb2YgSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5IZWFkZXJzKSk7DQoNCiAgICAvKg0KICAgICAgICB2YXIgaGVhZGVycyA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gcmVxdWVzdC5IZWFkZXJzKSB7DQogICAgICAgICAgICBpZiAocmVxdWVzdC5IZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzW2tleV0gPSByZXF1ZXN0LkhlYWRlcnNba2V5XVswXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICovDQoNCiAgICB2YXIgcmVxdWVzdEluZm8gPSB7DQogICAgICAgIEJvZHk6IHJlcXVlc3QuQm9keSwNCiAgICAgICAgSGVhZGVyczogcmVxdWVzdC5IZWFkZXJzLA0KICAgICAgICBTY2hlbWU6IHJlcXVlc3QuU2NoZW1lLA0KICAgICAgICBQYXJhbXM6IHJlcXVlc3QuUGFyYW1zLA0KICAgICAgICBNZXRob2Q6IG1ldGhvZCwNCiAgICAgICAgVVJMOiByZXF1ZXN0LlVSTA0KICAgIH07DQoNCiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSB7DQogICAgICAgIEJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RJbmZvLCB1bmRlZmluZWQsIDQpLA0KICAgICAgICBDb2RlOiAyMDANCiAgICB9Ow0KDQogICAgcmV0dXJuIFR5a0pzUmVzcG9uc2UocmVzcG9uc2VPYmplY3QsIHNlc3Npb24ubWV0YV9kYXRhKTsNCn0="
              path: /
              method: GET
              use_session: false
              proxy_on_error: false
